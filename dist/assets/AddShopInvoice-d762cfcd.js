import{r as b,N,A as E,ac as R,K as _,a4 as H,a as e,J,ak as K,X as P,al as M,Y as v,Z as x,am as O,j as o,Q as n,an as r,ao as d,ap as Q,F as X,$ as j,E as q,aq as Y,ar as Z,as as U,H as B,C as ee,a0 as te}from"./index-f69be7d7.js";import{I as ae}from"./IconButton-5e93c969.js";import{A as le}from"./x-circle-b084317e.js";const se="انشاء فاتورة",ce=ne=>{const[T,k]=b.useState(!1),z=N(),{isSuccess:y}=E(t=>t.dailyRows),D=R(),m=E(t=>t.products),G=m==null?void 0:m.data.map(t=>({label:t.name,id:t.id})),L={add:t=>{const{totalValue:s,totalValues:i}=t.products.reduce((l,c)=>{const p=c.value*c.count,h=c.values*c.count;return l.totalValue+=p,l.totalValues+=h,l},{totalValue:0,totalValues:0}),u=t.products.map(l=>({ProductId:l.id,count:l.count,value:l.value,values:l.values,note:l.note}));$(te({products:u,note:t.note,userId:D.shopId,value:s,values:i,billType:"ادخال",isDaily:!1}))}},$=_();return b.useEffect(()=>{$(H())},[]),b.useEffect(()=>{y&&T&&z(-1)},[y]),e(J,{title:`صفحة ${se}`,children:e(K,{initialValues:{products:[{id:"",count:"",value:"",values:"",note:""}],note:""},validationSchema:P({products:M(P({id:v().required("يرجى اختيار المنتج"),count:x().min(1,"يرجى كتابة عدد اكبر من الصفر").required("يرجى تحديد عدد البضاعة"),value:x().required("يرجى كتابة المبلغ"),values:x().min(1,"يرجى كتابة عدد اكبر من الصفر").required("يرجى كتابة القيمة"),note:v()})).min(1,"يرجى اضافة منتج واحد على الاقل للفاتورة"),note:v()}),onSubmit:(t,{setSubmitting:s})=>{L.add(t),s(!1),k(!0)},children:({values:t,errors:s,touched:i,isSubmitting:u,handleChange:l,handleBlur:c})=>e(O,{autoComplete:"off",children:o(n,{container:!0,children:[e(r,{name:"note",component:d,label:"ملاحظة الفاتورة",fullWidth:!0,sx:{mb:3}}),e(Q,{name:"products",children:({push:p,remove:h})=>e(X,{children:o(n,{container:!0,children:[t.products.map((ie,a)=>{var g,C,I,W,F,S,V,w,A;return o(j,{sx:{width:"100%",p:2,mb:3,boxShadow:"0px 0px 10px 1px #0d0d0d4a",borderRadius:".5rem"},children:[o(j,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:2},children:[o(q,{sx:{fontSize:"1.3rem",width:"100%"},children:["المنتج رقم ",a+1]}),e(ae,{onClick:()=>h(a),variant:"outlined",color:"error",size:"large",children:e(le,{})})]}),e(n,{item:!0,sx:{width:"100%"},children:e(Y,{fullWidth:!0,sx:{mb:3},error:((C=(g=i==null?void 0:i.products)==null?void 0:g[`${a}`])==null?void 0:C.id)&&Boolean((W=(I=s==null?void 0:s.products)==null?void 0:I[`${a}`])==null?void 0:W.id),children:e(r,{component:Z,fullWidth:!0,sx:{width:"100%"},name:`products.[${a}].id`,id:"product-select",label:"المنتج",onChange:l,value:((F=t.products[a])==null?void 0:F.id)||"",error:((V=(S=i==null?void 0:i.products)==null?void 0:S[`${a}`])==null?void 0:V.id)&&!!((A=(w=s==null?void 0:s.products)==null?void 0:w[`${a}`])!=null&&A.id),children:G.map(f=>e(U,{value:f.id,children:f.label},f.id))})})}),e(n,{item:!0,sx:{width:"100%"},children:e(r,{name:`products.[${a}].count`,type:"number",component:d,label:"العدد",fullWidth:!0,sx:{mb:3}})}),e(n,{item:!0,sx:{width:"100%"},children:e(r,{name:`products.[${a}].value`,type:"number",component:d,label:"المبلغ للواحدة",fullWidth:!0,sx:{mb:3}})}),e(n,{item:!0,sx:{width:"100%"},children:e(r,{name:`products.[${a}].values`,type:"number",component:d,label:"القيمة للواحدة",fullWidth:!0,sx:{mb:3}})}),e(n,{item:!0,sx:{width:"100%"},children:e(r,{name:`products.[${a}].note`,component:d,label:"ملاحظة",fullWidth:!0,sx:{mb:3}})})]},a)}),e(n,{container:!0,sx:{width:"100%"},spacing:3,justifyContent:"space-between",children:e(n,{item:!0,sx:{width:"50%"},children:e(B,{onClick:()=>p({id:"",count:"",value:"",values:"",note:""}),fullWidth:!0,variant:"outlined",color:"info",children:"اضافة منتج جديد"})})})]})})}),o(n,{item:!0,sx:{direction:"rtl",width:"100%"},children:[e(B,{variant:"contained",color:"success",sx:{p:2,mt:3},type:"submit",fullWidth:!0,disabled:u,startIcon:u&&e(ee,{size:"1rem",sx:{ml:2}}),children:u?"جاري الانشاء":"انشاء الفاتورة"}),e(q,{sx:{color:"tomato",mt:3,textAlign:"center",fontWeight:"bold"},children:t.products.length===0&&"يرجى تحديد منتج واحد على الاقل"})]})]})})})})};export{ce as default};
