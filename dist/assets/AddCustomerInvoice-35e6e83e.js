import{r as f,A,a9 as N,aa as R,N as _,a1 as H,a as e,J,ah as K,U as j,ai as M,V as b,W as v,aj as O,j as i,K as n,ak as o,al as c,am as U,F as X,X as E,E as P,an as Y,ao as Q,ap as Z,H as B,C as ee,Y as te}from"./index-13ef8f77.js";import{I as ae}from"./IconButton-19f28d84.js";import{A as le}from"./x-circle-6da33f19.js";const se="انشاء فاتورة",de=ne=>{const[T,k]=f.useState(!1),{isSuccess:x}=A(t=>t.dailyRows),q=N(),{data:z}=A(t=>t.products),D=R(),G=z.map(t=>({label:t.name,id:t.id})),L={add:t=>{const{totalValue:s,totalValues:r}=t.products.reduce((l,d)=>{const m=d.value*d.count,p=d.values*d.count;return l.totalValue+=m,l.totalValues+=p,l},{totalValue:0,totalValues:0}),u=t.products.map(l=>({ProductId:l.id,count:l.count,value:l.value,values:l.values,note:l.note}));y(te({products:u,note:t.note,userId:q.customerId,value:s,values:r,billType:"صادر",isDaily:!1}))}},y=_();return f.useEffect(()=>{y(H())},[]),f.useEffect(()=>{x&&T&&D(-1)},[x]),e(J,{title:`صفحة ${se}`,children:e(K,{initialValues:{products:[{id:"",count:"",value:"",values:"",note:""}],note:""},validationSchema:j({products:M(j({id:b().required("يرجى اختيار المنتج"),count:v().min(1,"يرجى كتابة عدد اكبر من الصفر").required("يرجى تحديد عدد البضاعة"),value:v().required("يرجى كتابة المبلغ"),values:v().min(1,"يرجى كتابة عدد اكبر من الصفر").required("يرجى كتابة القيمة"),note:b()})).min(1,"يرجى اضافة منتج واحد على الاقل للفاتورة"),note:b()}),onSubmit:(t,{setSubmitting:s,resetForm:r})=>{L.add(t),s(!1),k(!0)},children:({values:t,errors:s,touched:r,isSubmitting:u,handleChange:l,handleBlur:d})=>e(O,{autoComplete:"off",children:i(n,{container:!0,children:[e(o,{name:"note",component:c,label:"ملاحظة الفاتورة",fullWidth:!0,sx:{mb:3}}),e(U,{name:"products",children:({push:m,remove:p})=>e(X,{children:i(n,{container:!0,children:[t.products.map((re,a)=>{var $,g,C,W,F,I,V,S,w;return i(E,{sx:{width:"100%",p:2,mb:3,boxShadow:"0px 0px 10px 1px #0d0d0d4a",borderRadius:".5rem"},children:[i(E,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:2},children:[i(P,{sx:{fontSize:"1.3rem",width:"100%"},children:["المنتج رقم ",a+1]}),e(ae,{onClick:()=>p(a),variant:"outlined",color:"error",size:"large",children:e(le,{})})]}),e(n,{item:!0,sx:{width:"100%"},children:e(Y,{fullWidth:!0,sx:{mb:3},error:((g=($=r==null?void 0:r.products)==null?void 0:$[`${a}`])==null?void 0:g.id)&&Boolean((W=(C=s==null?void 0:s.products)==null?void 0:C[`${a}`])==null?void 0:W.id),children:e(o,{component:Q,fullWidth:!0,sx:{width:"100%"},name:`products.[${a}].id`,id:"product-select",label:"المنتج",onChange:l,value:((F=t.products[a])==null?void 0:F.id)||"",error:((V=(I=r==null?void 0:r.products)==null?void 0:I[`${a}`])==null?void 0:V.id)&&!!((w=(S=s==null?void 0:s.products)==null?void 0:S[`${a}`])!=null&&w.id),children:G.map(h=>e(Z,{value:h.id,children:h.label},h.id))})})}),e(n,{item:!0,sx:{width:"100%"},children:e(o,{name:`products.[${a}].count`,type:"number",component:c,label:"العدد",fullWidth:!0,sx:{mb:3}})}),e(n,{item:!0,sx:{width:"100%"},children:e(o,{name:`products.[${a}].value`,type:"number",component:c,label:"المبلغ للواحدة",fullWidth:!0,sx:{mb:3}})}),e(n,{item:!0,sx:{width:"100%"},children:e(o,{name:`products.[${a}].values`,type:"number",component:c,label:"القيمة للواحدة",fullWidth:!0,sx:{mb:3}})}),e(n,{item:!0,sx:{width:"100%"},children:e(o,{name:`products.[${a}].note`,component:c,label:"ملاحظة",fullWidth:!0,sx:{mb:3}})})]},a)}),e(n,{container:!0,sx:{width:"100%"},spacing:3,justifyContent:"space-between",children:e(n,{item:!0,sx:{width:"50%"},children:e(B,{onClick:()=>m({id:"",count:"",value:"",values:"",note:""}),fullWidth:!0,variant:"outlined",color:"info",children:"اضافة منتج جديد"})})})]})})}),i(n,{item:!0,sx:{direction:"rtl",width:"100%"},children:[e(B,{variant:"contained",color:"success",sx:{p:2,mt:3},type:"submit",fullWidth:!0,disabled:u,startIcon:u&&e(ee,{size:"1rem",sx:{ml:2}}),children:u?"جاري الانشاء":"انشاء الفاتورة"}),e(P,{sx:{color:"tomato",mt:3,textAlign:"center",fontWeight:"bold"},children:t.products.length===0&&"يرجى تحديد منتج واحد على الاقل"})]})]})})})})};export{de as default};
