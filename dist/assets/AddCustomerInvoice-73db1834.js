import{r as f,A,ac as N,N as R,K as _,a4 as H,a as e,J,ak as K,X as E,al as M,Y as b,Z as v,am as O,j as o,Q as n,an as i,ao as d,ap as Q,F as X,$ as P,E as j,aq as Y,ar as Z,as as U,H as q,C as ee,a0 as te}from"./index-f69be7d7.js";import{I as ae}from"./IconButton-5e93c969.js";import{A as le}from"./x-circle-b084317e.js";const se="انشاء فاتورة",ce=ne=>{const[B,T]=f.useState(!1),{isSuccess:x}=A(t=>t.dailyRows),k=N(),{data:z}=A(t=>t.products),D=R(),G=z.map(t=>({label:t.name,id:t.id})),L={add:t=>{const{totalValue:s,totalValues:r}=t.products.reduce((l,c)=>{const m=c.value*c.count,p=c.values*c.count;return l.totalValue+=m,l.totalValues+=p,l},{totalValue:0,totalValues:0}),u=t.products.map(l=>({ProductId:l.id,count:l.count,value:l.value,values:l.values,note:l.note}));y(te({products:u,note:t.note,userId:k.customerId,value:s,values:r,billType:"صادر",isDaily:!1}))}},y=_();return f.useEffect(()=>{y(H())},[]),f.useEffect(()=>{x&&B&&D(-1)},[x]),e(J,{title:`صفحة ${se}`,children:e(K,{initialValues:{products:[{id:"",count:"",value:"",values:"",note:""}],note:""},validationSchema:E({products:M(E({id:b().required("يرجى اختيار المنتج"),count:v().min(1,"يرجى كتابة عدد اكبر من الصفر").required("يرجى تحديد عدد البضاعة"),value:v().required("يرجى كتابة المبلغ"),values:v().required("يرجى كتابة القيمة"),note:b()})).min(1,"يرجى اضافة منتج واحد على الاقل للفاتورة"),note:b()}),onSubmit:(t,{setSubmitting:s,resetForm:r})=>{L.add(t),s(!1),T(!0)},children:({values:t,errors:s,touched:r,isSubmitting:u,handleChange:l,handleBlur:c})=>e(O,{autoComplete:"off",children:o(n,{container:!0,children:[e(i,{name:"note",component:d,label:"ملاحظة الفاتورة",fullWidth:!0,sx:{mb:3}}),e(Q,{name:"products",children:({push:m,remove:p})=>e(X,{children:o(n,{container:!0,children:[t.products.map((re,a)=>{var $,g,C,F,I,W,S,V,w;return o(P,{sx:{width:"100%",p:2,mb:3,boxShadow:"0px 0px 10px 1px #0d0d0d4a",borderRadius:".5rem"},children:[o(P,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:2},children:[o(j,{sx:{fontSize:"1.3rem",width:"100%"},children:["المنتج رقم ",a+1]}),e(ae,{onClick:()=>p(a),variant:"outlined",color:"error",size:"large",children:e(le,{})})]}),e(n,{item:!0,sx:{width:"100%"},children:e(Y,{fullWidth:!0,sx:{mb:3},error:((g=($=r==null?void 0:r.products)==null?void 0:$[`${a}`])==null?void 0:g.id)&&Boolean((F=(C=s==null?void 0:s.products)==null?void 0:C[`${a}`])==null?void 0:F.id),children:e(i,{component:Z,fullWidth:!0,sx:{width:"100%"},name:`products.[${a}].id`,id:"product-select",label:"المنتج",onChange:l,value:((I=t.products[a])==null?void 0:I.id)||"",error:((S=(W=r==null?void 0:r.products)==null?void 0:W[`${a}`])==null?void 0:S.id)&&!!((w=(V=s==null?void 0:s.products)==null?void 0:V[`${a}`])!=null&&w.id),children:G.map(h=>e(U,{value:h.id,children:h.label},h.id))})})}),e(n,{item:!0,sx:{width:"100%"},children:e(i,{name:`products.[${a}].count`,type:"number",component:d,label:"العدد",fullWidth:!0,sx:{mb:3}})}),e(n,{item:!0,sx:{width:"100%"},children:e(i,{name:`products.[${a}].value`,type:"number",component:d,label:"المبلغ للواحدة",fullWidth:!0,sx:{mb:3}})}),e(n,{item:!0,sx:{width:"100%"},children:e(i,{name:`products.[${a}].values`,type:"number",component:d,label:"القيمة للواحدة",fullWidth:!0,sx:{mb:3}})}),e(n,{item:!0,sx:{width:"100%"},children:e(i,{name:`products.[${a}].note`,component:d,label:"ملاحظة",fullWidth:!0,sx:{mb:3}})})]},a)}),e(n,{container:!0,sx:{width:"100%"},spacing:3,justifyContent:"space-between",children:e(n,{item:!0,sx:{width:"50%"},children:e(q,{onClick:()=>m({id:"",count:"",value:"",values:"",note:""}),fullWidth:!0,variant:"outlined",color:"info",children:"اضافة منتج جديد"})})})]})})}),o(n,{item:!0,sx:{direction:"rtl",width:"100%"},children:[e(q,{variant:"contained",color:"success",sx:{p:2,mt:3},type:"submit",fullWidth:!0,disabled:u,startIcon:u&&e(ee,{size:"1rem",sx:{ml:2}}),children:u?"جاري الانشاء":"انشاء الفاتورة"}),e(j,{sx:{color:"tomato",mt:3,textAlign:"center",fontWeight:"bold"},children:t.products.length===0&&"يرجى تحديد منتج واحد على الاقل"})]})]})})})})};export{ce as default};
