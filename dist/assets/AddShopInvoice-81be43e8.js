import{r as b,aa as N,A as j,a9 as R,N as _,a1 as H,a as e,J,ai as K,U as E,aj as M,V as v,W as x,ak as O,j as o,K as n,al as r,am as c,an as U,F as X,X as P,E as q,ao as Y,ap as Q,aq as Z,H as B,C as ee,Y as te}from"./index-8aa1702d.js";import{I as ae}from"./IconButton-2bd4868e.js";import{A as le}from"./x-circle-e5fd3475.js";const se="انشاء فاتورة",de=ne=>{const[T,k]=b.useState(!1),z=N(),{isSuccess:y}=j(t=>t.dailyRows),D=R(),m=j(t=>t.products),G=m==null?void 0:m.data.map(t=>({label:t.name,id:t.id})),L={add:t=>{const{totalValue:s,totalValues:i}=t.products.reduce((l,d)=>{const p=d.value*d.count,h=d.values*d.count;return l.totalValue+=p,l.totalValues+=h,l},{totalValue:0,totalValues:0}),u=t.products.map(l=>({ProductId:l.id,count:l.count,value:l.value,values:l.values,note:l.note}));$(te({products:u,note:t.note,userId:D.shopId,value:s,values:i,billType:"ادخال",isDaily:!1}))}},$=_();return b.useEffect(()=>{$(H())},[]),b.useEffect(()=>{y&&T&&z(-1)},[y]),e(J,{title:`صفحة ${se}`,children:e(K,{initialValues:{products:[{id:"",count:"",value:"",values:"",note:""}],note:""},validationSchema:E({products:M(E({id:v().required("يرجى اختيار المنتج"),count:x().min(1,"يرجى كتابة عدد اكبر من الصفر").required("يرجى تحديد عدد البضاعة"),value:x().required("يرجى كتابة المبلغ"),values:x().min(1,"يرجى كتابة عدد اكبر من الصفر").required("يرجى كتابة القيمة"),note:v()})).min(1,"يرجى اضافة منتج واحد على الاقل للفاتورة"),note:v()}),onSubmit:(t,{setSubmitting:s})=>{L.add(t),s(!1),k(!0)},children:({values:t,errors:s,touched:i,isSubmitting:u,handleChange:l,handleBlur:d})=>e(O,{autoComplete:"off",children:o(n,{container:!0,children:[e(r,{name:"note",component:c,label:"ملاحظة الفاتورة",fullWidth:!0,sx:{mb:3}}),e(U,{name:"products",children:({push:p,remove:h})=>e(X,{children:o(n,{container:!0,children:[t.products.map((ie,a)=>{var g,C,W,I,V,F,S,w,A;return o(P,{sx:{width:"100%",p:2,mb:3,boxShadow:"0px 0px 10px 1px #0d0d0d4a",borderRadius:".5rem"},children:[o(P,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:2},children:[o(q,{sx:{fontSize:"1.3rem",width:"100%"},children:["المنتج رقم ",a+1]}),e(ae,{onClick:()=>h(a),variant:"outlined",color:"error",size:"large",children:e(le,{})})]}),e(n,{item:!0,sx:{width:"100%"},children:e(Y,{fullWidth:!0,sx:{mb:3},error:((C=(g=i==null?void 0:i.products)==null?void 0:g[`${a}`])==null?void 0:C.id)&&Boolean((I=(W=s==null?void 0:s.products)==null?void 0:W[`${a}`])==null?void 0:I.id),children:e(r,{component:Q,fullWidth:!0,sx:{width:"100%"},name:`products.[${a}].id`,id:"product-select",label:"المنتج",onChange:l,value:((V=t.products[a])==null?void 0:V.id)||"",error:((S=(F=i==null?void 0:i.products)==null?void 0:F[`${a}`])==null?void 0:S.id)&&!!((A=(w=s==null?void 0:s.products)==null?void 0:w[`${a}`])!=null&&A.id),children:G.map(f=>e(Z,{value:f.id,children:f.label},f.id))})})}),e(n,{item:!0,sx:{width:"100%"},children:e(r,{name:`products.[${a}].count`,type:"number",component:c,label:"العدد",fullWidth:!0,sx:{mb:3}})}),e(n,{item:!0,sx:{width:"100%"},children:e(r,{name:`products.[${a}].value`,type:"number",component:c,label:"المبلغ للواحدة",fullWidth:!0,sx:{mb:3}})}),e(n,{item:!0,sx:{width:"100%"},children:e(r,{name:`products.[${a}].values`,type:"number",component:c,label:"القيمة للواحدة",fullWidth:!0,sx:{mb:3}})}),e(n,{item:!0,sx:{width:"100%"},children:e(r,{name:`products.[${a}].note`,component:c,label:"ملاحظة",fullWidth:!0,sx:{mb:3}})})]},a)}),e(n,{container:!0,sx:{width:"100%"},spacing:3,justifyContent:"space-between",children:e(n,{item:!0,sx:{width:"50%"},children:e(B,{onClick:()=>p({id:"",count:"",value:"",values:"",note:""}),fullWidth:!0,variant:"outlined",color:"info",children:"اضافة منتج جديد"})})})]})})}),o(n,{item:!0,sx:{direction:"rtl",width:"100%"},children:[e(B,{variant:"contained",color:"success",sx:{p:2,mt:3},type:"submit",fullWidth:!0,disabled:u,startIcon:u&&e(ee,{size:"1rem",sx:{ml:2}}),children:u?"جاري الانشاء":"انشاء الفاتورة"}),e(q,{sx:{color:"tomato",mt:3,textAlign:"center",fontWeight:"bold"},children:t.products.length===0&&"يرجى تحديد منتج واحد على الاقل"})]})]})})})})};export{de as default};
